---
title: "Mtcars MPG against Transmission"
author: "Sean Dunagan"
date: "October 23, 2015"
output: html_document
---

<style type="text/css">

body, td {
   font-size: 12px;
}
code.r{
  font-size: 10px;
}
pre {
  font-size: 10px
}
</style>

```{r, echo=FALSE}
library(knitr)
source('./course_project.R');
mtcarsRegressionAnalyzerInstance <- mtcarsRegressionAnalyzerFactory();
mtcarsRegressionAnalyzerInstance$separateAutomaticAndManualTransmissionCars();

```

## Prompt
You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

1. Is an automatic or manual transmission better for MPG
2. Quantify the MPG difference between automatic and manual transmissions

Take the mtcars data set and write up an analysis to answer their question using regression models and exploratory data analyses.

Naturally units for every measurement of MPG given are Miles per Gallon.

## Exploratory Data Analyses
A natural first step in addressing these questions would be to see the distribution of MPG values for each transmissions type. Figure 1 in the Appendix (MPG by Transmission Type) displays this visually via a boxplot. It is easy to see via this boxplot that the MPG values tend to be higher for the Manual transmission type. The quantile data displayed in the boxplot is given below via the R summary() function for Automatic and Manual transmissions respectively

```{r, echo=FALSE}
mtcarsRegressionAnalyzerInstance$summarizeMpgByAutomaticTransmission();
mtcarsRegressionAnalyzerInstance$summarizeMpgByManualTransmission();
```

A natural next step would be to look at all of the variables contained in the mtcars dataset
```{r, echo=FALSE}
head(mtcars, n = 1);
```

## Regression Models
An obvious model to explore would be the interaction between the transmission type and the MPG values. The coefficients for this linear model are given below (According to the ?mtcars R documentation, the values for am are 0 = automatic, 1 = manual):

```{r}
mpgByAmModel <- lm(mpg ~ am, data = mtcars);
summary(mpgByAmModel)$coefficients;
```

We can see from the coefficients above that the estimate for the intercept is 17.147368; this is the estimated MPG value for am values of 0 (meaning for Automatic Transmissions). The estimate for the am coefficient is 7.244939. This indicates that for an am value of 1 (Manual Transmissions) the estimated MPG value is the intercept (17.147368) + 7.244939; this yields an estimated MPG value of 24.39231 for Manual Transmissions. This also indicates that the difference in MPG values between transmission types is 7.244939 MPG. Figure 2 in the Appendix 
displays this linear model visually, including lines denoting the mean estimated values for the transmission types.

While this displays the relationship between MPG and transmission type, anyone with subject matter knowledge in the automotive realm will note that there are a couple of additional variables which are greatly correlated with the MPG value of a car (and which are not redundant to transmission type). To this note, the $R^2$ value of the mpg ~ am model is only 0.3598, meaning that only 36% of the variance in the data is explained by our mpg ~ am model. Surely there are other variables affecting the response (MPG).

In particular, the number of cylinders and the weight of a car are very related to the MPG of a car. As such, we should inspect model which include these variables

```{r}
mpgByAmAndWeightAndCylindersModel <- lm(mpg ~ am + wt + cyl, data = mtcars);
summary(mpgByAmAndWeightAndCylindersModel)$coefficients;
summary(mpgByAmAndWeightAndCylindersModel)$r.squared;
```

The $R^2$ value for this model is 0.8303, MUCH higher than the mpg ~ am model; this indicates that our new model accounts for 47% more of the total variance in MPG than the previous model did. In terms of the variables themselves, the model indicates that both cyl and wt have an inverse relationship with MPG, meaning that an increase in the amount of cylinders or an increase in the weight of the car will decrease the MPG of the car. The P values for these two variables are each under .002, so we can conclude this with great certainty. However, for am, the P value is .893; looking at the standard error for am, we see that it is 1.3, greater than the estimate of 0.1765 for the coefficient. As such, we can't say with great confidence at all whether mpg is inversely or directly relatred to am. As such, we might look for another variable to reduce the standard error for am, since this is the variable we are particularly concerned with.

```{r}
mpgByAmAndWeightAndCylindersAndCarbsModel <- lm(mpg ~ am + wt + cyl + carb, data = mtcars);
summary(mpgByAmAndWeightAndCylindersAndCarbsModel)$coefficients;
summary(mpgByAmAndWeightAndCylindersAndCarbsModel)$r.squared;
```

Carburetors are responsible for fuel injection for the car's engine; as such, it would be very reasonable to assume that the number of carburetors is related to the MPG of a car. When we add this regressor to the model, we see the P value for the am regressor plummet to .249; at this point, we would say with 75.1% confidence that MPG increases as am increases (meaning with manual transmission). The estimate of 1.78 would suggest that Manual transmissions result in an average of 1.78 more miles per gallon for a car. Naturally, as we include more regressors into the model, the standaard errors of the other regressors increases. This is evidenced by the fact that the P values for the wt and cyl coefficients have increased by 609% and 733% respectively. However, given that the P values are still under .02, they are still within the typical 95% confidence interval. 

```{r}
anova(mpgByAmModel, mpgByAmAndWeightAndCylindersModel, mpgByAmAndWeightAndCylindersAndCarbsModel);
```

As we can see from the anova() output above, the Residual Sum of Squares decreases greatly with the addition of the wt, cyl, and carb regressor variables. 

## Answering the Question of Interest
Given our model taking into account mpg ~ am + wt + cyl + carb, we obtained a regression coefficient of 1.78, with standard error 1.51 and p value .249. As such, the coefficient is above 0 within the bounds of the standard error. Additionally, with a p value of .249, we would say with 75.1% confidence that Manual Transmissions lead to higher MPG values than Automatic transmissions. We would estimate that Manual Transmissions result in an average of 1.78 MPG greater than Automatic Transmissions.




# Appendix
## Figure 1
```{r, echo=FALSE}
mtcarsRegressionAnalyzerInstance$boxplotMpgByTransmissions();
```

## Figure 2
```{r, echo=FALSE}
mtcarsRegressionAnalyzerInstance$plotLinearModelBetweenMpgAndTransmissionUsingBase();
```
